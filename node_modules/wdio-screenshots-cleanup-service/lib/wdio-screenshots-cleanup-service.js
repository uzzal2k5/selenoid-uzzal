"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var rimraf = require("rimraf");
var path = require("path");
var fs = require("fs");
var WdioScreenshotsCleanupService = /** @class */ (function () {
    function WdioScreenshotsCleanupService() {
    }
    WdioScreenshotsCleanupService.prototype.onPrepare = function (config) {
        return new Promise(function (resolve, reject) {
            var options = config.cleanScreenshotsFolder;
            var screenshotsFolder = path.isAbsolute(options.folder)
                ? options.folder
                : path.join(process.cwd(), options.folder);
            fs.exists(screenshotsFolder, function (exists) {
                if (exists) {
                    if (options.pattern) {
                        var pattern_1 = options.pattern;
                        var dir = path.join(screenshotsFolder, pattern_1);
                        rimraf(dir, function (err) {
                            if (err) {
                                console.error("Failed to delete screenshots in folder: " + screenshotsFolder + " using pattern " + pattern_1, err);
                                return reject(err);
                            }
                        });
                    }
                    else {
                        rimraf(screenshotsFolder, function (err) {
                            if (err) {
                                console.error("Failed to delete screenshots folder: " + screenshotsFolder, err);
                                return reject(err);
                            }
                        });
                    }
                    return resolve();
                }
            });
            return resolve();
        });
    };
    return WdioScreenshotsCleanupService;
}());
exports.default = WdioScreenshotsCleanupService;
